<%- include('../partials/adminheadder') %>
<div class="content-wrapper">
  <div class="page-header">
    <h2>fgf</h2>
  </div>
  <div class="row">
    <div class="col-lg-12 grid-margin stretch-card">
      <div class="card">
        <div class="card-body">
          <h4 class="card-title">Banner Management</h4>
          <div class="table-responsive">
            <table class="table table-striped table-dark">
              <thead>
                <tr>
                  <th>title</th>
                  <th>image</th>
                  <th>status</th>
                  <th>action</th>
                  <th>Edit</th>
                </tr>
              </thead>
              <tbody>
                <% for (let i = 0; i < 3; i++) { %>
                <tr>
                  <td><%=Banner[i].title%></td>
                  <td><%=Banner[i].description%></td>
                  <td>
                    <% if (Banner[i].status==true) { %>
                    <p id="status<%=Banner[i]._id%>" style="color: green">
                      active
                    </p>
                    <% } else { %>
                    <p
                      id="status<%=Banner[i]._id%>"
                      style="color: rgb(230, 0, 0)"
                    >
                      blocked
                    </p>
                    <% } %>
                  </td>
                  <td>
                    <% if (Banner[i].status==true) { %>
                    <button
                      style="background-color: red"
                      type="button"
                      id="block<%=Banner[i]._id%>"
                      onclick="blockBanner('<%=Banner[i]._id%>')"
                      class="btn btn-danger"
                    >
                      Block
                    </button>
                    <% } else { %>
                    <button
                      style="background-color: green"
                      type="button"
                      id="block<%=Banner[i]._id%>"
                      onclick="blockBanner('<%=Banner[i]._id%>')"
                      class="btn btn-success"
                    >
                      unblock
                    </button>
                    <% } %>
                  </td>
                  <td>
                    <a href="edit-banner?id=<%=Banner[i]._id%>"
                      ><button
                        type="button"
                        class="btn btn-primary"
                      >
                        Edit
                      </button></a
                    >
                  </td>
                </tr>

                <% } %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function blockBanner(id) {
    const statusCell = document.getElementById(`status${id}`);
    const btn = document.getElementById(`block${id}`);
    fetch(`/admin/blockBanner`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ id }),
    })
      .then((response) => {
        if (!response.ok) {
          throw new Error(`Failed to block user with ID ${id}`);
        }
        return response.json();
      })
      .then((data) => {
        if (data.blocked) {
          statusCell.innerHTML = data.statustext;
          statusCell.style.color = data.textcolor;
          btn.innerHTML = data.btntext;
          btn.style.backgroundColor = data.btncolor;
          btn.style.border = 0;
        } else {
          statusCell.innerHTML = data.statustext;
          statusCell.style.color = data.textcolor;
          btn.innerHTML = data.btntext;
          btn.style.backgroundColor = data.btncolor;
        }
      })

      .catch((error) => {
        console.error(error);
      });
  }
</script>
<%- include('../partials/adminfooter') %>
