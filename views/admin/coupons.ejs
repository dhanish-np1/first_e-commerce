<%- include('../partials/adminheadder') %>
<div class="content-wrapper">
  <div class="page-header">
    <h2>fgf</h2>
  </div>
  <div class="row">
    <div class="col-lg-12 grid-margin stretch-card">
      <div class="card">
        <div class="card-body">
          <h4 class="card-title">Coupons Table</h4>
          <a href="/admin/add-coupons"
            ><button
              type="button"
              style="margin-bottom: 15px; border-radius: 15px"
              class="btn btn-outline-primary"
            >
              add coupons
            </button></a
          >
          <div class="table-responsive">
            <table class="table table-striped table-dark">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Code</th>
                  <th>Discount <br />Amount</th>
                  <th>Amount <br />Criteria</th>
                  <th>
                    Activation<br />
                    Date
                  </th>
                  <th>Expiry Date</th>
                  <th>User Limit</th>
                  <th>Used Users</th>
                  <!-- <th>Edit</th> -->
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <% if (coupon.length>0) { %> <% for (let i = 0; i <
                coupon.length; i++) { %>
                <tr>
                  <td><%=coupon[i].couponName%></td>
                  <td><%=coupon[i].couponCode%></td>
                  <td><%=coupon[i].discountAmount%></td>
                  <td><%=coupon[i].criteriaAmount%></td>

                  <td>
                    <%= typeof coupon[i].activationDate==='string' ?
                    coupon[i].activationDate.slice(0, 10) :
                    coupon[i].activationDate.toISOString().slice(0, 10) %>
                  </td>
                  <td>
                    <%= typeof coupon[i].expiryDate==='string' ?
                    coupon[i].expiryDate.slice(0, 10) :
                    coupon[i].expiryDate.toISOString().slice(0, 10) %>
                  </td>
                  <td><%=coupon[i].usersLimit%></td>
                  <td><%=coupon[i].usedUsers.length%></td>
                  <!-- <td><button type="button" class="btn btn-primary">Edit</button></td> -->
                  <% if (coupon[i].status) { %>
                    <td>
                      <button
                        style="background-color: red"
                        type="button"
                        id="block<%=coupon[i]._id%>"
                        onclick="blockCoupon('<%=coupon[i]._id%>')"
                        class="btn btn-danger"
                      >
                        Block
                      </button>
                    </td>
                    <% } else { %>
                    <td>
                      <button
                        style="background-color: green"
                        type="button"
                        id="block<%=coupon[i]._id%>"
                        onclick="blockCoupon('<%=coupon[i]._id%>')"
                        class="btn btn-success"
                      >
                        unblock
                      </button>
                    </td>
                    <% } %>
                </tr>
                <% } %> <% } else { %>
                <tr>
                  <td colspan="10" style="text-align: center">
                    coupons not found
                  </td>
                </tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  function blockCoupon(id) {
    const btn = document.getElementById(`block${id}`);
    $.ajax({
      url: "block-coupons",
      method: "POST",
      data: {
        _id:id
      },
      dataType: "json",
      success: function (response) {
        console.log(response.success);
        if (response.blocked) {
          btn.innerHTML = response.btntext;
          btn.style.backgroundColor = response.btncolor;
          btn.style.border = 0;
        } else {
          btn.innerHTML = response.btntext;
          btn.style.backgroundColor = response.btncolor;
        }
      },
      error: function (jqXHR, textStatus, errorThrown) {
        console.log("not wanted");
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "Error updating product quantity",
        });

        console.error("AJAX Error:", textStatus, errorThrown);
      },
    });
  }
</script>
<%- include('../partials/adminfooter') %>
