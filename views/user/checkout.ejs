<!-- breadcrumb -->
<div class="container">
  <div class="bread-crumb flex-w p-l-25 p-r-15 p-t-30 p-lr-0-lg">
    <a href="/cart" class="stext-109 cl8 hov-cl1 trans-04">
      cart
      <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
    </a>

    <span class="stext-109 cl4"> chekout </span>
  </div>
</div>


<!-- Shoping Cart -->
<form class="bg0 p-t-75 p-b-85" id="submitOrder">
  <div class="container">
    <div class="row">
      <div class="col-lg-10 col-xl-7 m-lr-auto m-b-50">
        <div
          class="m-l-25 m-r--38 m-lr-0-xl"
          style="display: flex; flex-wrap: wrap; gap: 20px; color: black"
        >
        <a href="/load-add-address?page=/chekout">
          <div class="addAddressInChek">
            <img src="/user/icon/Untitled.png" alt="" />
            <p
              style="
                font-size: 30px;
                font-weight: 700;
                font-size: 24px;
                line-height: 32px;
              "
            >
              Add Address
            </p>
          </div>
        </a>
          <% for (let i = 0; i < Address?.address.length; i++) { %>

          <div class="selectAddress">
            <div class="form-check">
              <input
                value="<%=Address.address[i]._id%>"
                style="border: 2px solid black"
                class="form-check-input"
                type="radio"
                name="address_id"
                id="flexRadioDefault<%=i+1%>"
              />
              <label class="form-check-label" for="flexRadioDefault<%=i+1%>">
                <%=Address.address[i].fullname%>
              </label>
            </div>

            <p><%=Address.address[i].mobile%></p>
            <p><%=Address.address[i].email%></p>
            <p><%=Address.address[i].state%></p>
            <p><%=Address.address[i].houseName%></p>
            <p><%=Address.address[i].city%></p>
            <p><%=Address.address[i].pin%></p>
          </div>
          <% } %>
          
        </div>
      </div>

      <div class="col-sm-10 col-lg-7 col-xl-5 m-lr-auto m-b-50">
        <div
          class="bor10 p-lr-40 p-t-30 p-b-40 m-l-63 m-r-40 m-lr-0-xl p-lr-15-sm"
        >
          <h4 class="mtext-109 cl2 p-b-30">Total  Items</h4>

          <div class="flex-w flex-t bor12 p-b-13">
            <div class="size-208">
              <span class="stext-110 cl2"> Subtotal: </span>
            </div>

            <div class="size-209">
              <span class="mtext-110 cl2"> $79.65 </span>
            </div>
          </div>

          <div class="flex-w flex-t p-t-27 p-b-33">
            <div class="size-208">
              <span class="mtext-101 cl2"> Total: </span>
            </div>

            <div class="size-209 p-t-1">
              <span class="mtext-110 cl2"> $79.65 </span>
            </div>
          </div>
          <div class="form-check">
            <input
              value="COD"
              style="border: 2px solid black"
              class="form-check-input"
              type="radio"
              name="PaymentMethod"
              id="PaymentMethod1"
              checked
            />
            <label class="form-check-label" for="PaymentMethod1">
              Cash On Delivery
            </label>
          </div>
          <div class="form-check">
            <input
              style="border: 2px solid black"
              class="form-check-input"
              type="radio"
              name="PaymentMethod"
              id="PaymentMethod2"
              value="online_Payment"
            />
            <label class="form-check-label" for="PaymentMethod2">
              Online Payment
            </label>
          </div>
          <div class="form-check">
            <input
              style="border: 2px solid black"
              class="form-check-input"
              type="radio"
              name="PaymentMethod"
              id="PaymentMethod3"
              value="Wallet"
            />
            <label class="form-check-label" for="PaymentMethod3">
              Wallet
            </label>
          </div>

          <button
            onclick="submitForm()"
            type="button"
            class="flex-c-m stext-101 cl0 size-116 bg3 bor14 hov-btn3 p-lr-15 trans-04 pointer"
          >
            PLACE ORDER
          </button>
        </div>
      </div>
    </div>
  </div>
</form>

<script>
  function submitForm() {
    const formData = new FormData(document.getElementById("submitOrder"));
    const urlSearchParams = new URLSearchParams(formData);
   
    fetch("/placeOrder", {
      method: "POST",
      body: urlSearchParams,
      headers: {
        "Content-type": "application/x-www-form-urlencoded; charset=UTF-8",
      },
    })
    .then((response) => {
        if (!response.ok) {
          console.log(response.status)
          throw new Error("Network response was not ok");
        }
        return response.json();
      })
      .then((data) => {
        if (data.success) {
          window.location.href = "/orderSuccess";
        } else {
          console.log("working");
          Swal.fire({
            icon: "error",
            title: "Error",
            text: data.message,
          });
        }
      })

      .catch((error) => {
        console.log(error)
      });
  }
</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>